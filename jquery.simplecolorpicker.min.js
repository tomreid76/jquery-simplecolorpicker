/*!
 * jQuery Simple Color Picker v1.0
 * https://github.com/tomreid76/jquery-simplecolorpicker
 *
 * Copyright 2013 Tom Reid
 * Released under the MIT license
 */
(function($,window,document,undefined){var SimpleColorPicker=function(elem,options){this.$input=$(elem);this.options=options;this.metadata=eval(this.$input.data("options"))};SimpleColorPicker.prototype={defaults:{defaultColor:{name:"default (white)",hex:"fff"},boxBorderWidth:1,cellWidth:20,cellHeight:20,cellBorder:1,inputWidth:25,inputHeight:25,columns:10,colors:[{name:"brown",hex:"7a4100"},{name:"green",hex:"00aa00"},{name:"red",hex:"cc0000"},{name:"aqua",hex:"039799"},{name:"pink",hex:"b0307a"},{name:"purple",hex:"762ca7"},{name:"orange",hex:"cc6600"},{name:"gray",hex:"555555"},{name:"black",hex:"000000"},{name:"blue",hex:"0000dd"}],iconPosition:"right",animationSpeed:50,pickerClass:"color-picker-chooser",textCurrentColor:"Current color: "},init:function(){var e=this;e.config=$.extend(true,{},e.defaults,e.options,e.metadata);e.config.totalWidth=e.config.columns*(e.config.cellWidth+2*e.config.cellBorder);e.config.totalHeight=Math.ceil(e.config.colors.length/e.config.columns)*(e.config.cellHeight+2*e.config.cellBorder);e.setupInputElement();e.$picker=e.getPickerMenu();$("body").append(e.$picker);e.bindPickerEvents();$(window).resize(function(){e.setPickerPosition(e.$picker)});return e},getIconPosition:function(){var e;switch(this.config.iconPosition){case"center":e="center";break;case"left":e="4px center";break;case"right":default:e=this.config.inputWidth-20+"px";break}return e},setupInputElement:function(){var e=this,t=e.$input.val()&&e.$input.val()!==""?e.$input.val():e.config.defaultColor.hex;e.$input.css({backgroundColor:"#"+t,backgroundPosition:e.getIconPosition(),borderWidth:e.config.boxBorderWidth+"px",width:e.config.inputWidth+"px",height:e.config.inputHeight+"px",color:"#"+e.$input.val()})},close:function(){var e=this;e.$picker.slideUp(e.config.animationSpeed).find("a").removeClass("selected");e.$input.removeClass("open").focus();$(document).off("mouseup.cp"+e.colorPickerInstance,"html")},open:function(){var e=this;e.setPickerPosition(e.$picker);e.$input.addClass("open");e.$picker.slideDown(e.config.animationSpeed);$(document).on("mouseup.cp"+e.colorPickerInstance,"html",function(){e.close.call(e)})},setPickerPosition:function(e){var t=this,n=t.$input.offset(),r=t.$input.height();e.css({top:n.top+r+t.config.boxBorderWidth,left:n.left})},getCells:function(){var e=this,t=e.config.colors.length,n=$("<div/>"),r,i;for(r=0;r<t;r++){i=$("<li tabindex='0' title='"+e.config.colors[r].name+"' data-color='"+e.config.colors[r].hex+"'></li>");i.css({width:e.config.cellWidth+"px",height:e.config.cellHeight+"px",border:e.config.cellBorder+"px solid #fff",lineHeight:e.config.cellHeight+"px",backgroundColor:"#"+e.config.colors[r].hex});n.append(i)}return n},getPickerMenu:function(){var e=this;e.colorPickerInstance=$("."+e.config.pickerClass).length+1;var t=$("<ul class='"+e.config.pickerClass+"' id='cp-"+e.colorPickerInstance+"' />"),n;e.setPickerPosition(t);t.css({borderWidth:e.config.boxBorderWidth+"px",width:e.config.totalWidth+"px",height:e.config.totalHeight+"px",display:"none"});n=e.getCells(t);t.append(n.children());return t},bindPickerEvents:function(){var e=this,t=e.$picker.find("li");e.$input.bind({mouseup:function(t){e.$picker.is(":visible")?e.close():e.open();t.stopPropagation()},keydown:function(t){switch(t.which){case 13:e.$input.trigger("mouseup");break;case 27:e.close();t.stopPropagation();break;case 40:e.open();e.$picker.find("li:first").focus().addClass("selected");break;case 9:if(e.$picker.is(":visible")){e.$picker.find("li:first").focus().addClass("selected");t.preventDefault()}break}}});t.bind({keydown:function(t){var n=$(this),r=n.siblings().andSelf();switch(t.which){case 13:n.trigger("mouseup");break;case 27:n.removeClass("selected");e.close();t.stopPropagation();break;case 37:if(n.prevAll().length===0){n.removeClass("selected").siblings(":last").focus().addClass("selected")}else{n.removeClass("selected").prev().focus().addClass("selected")}break;case 38:var i=r.index(n)-e.config.columns;if(i>-1){n.removeClass("selected");$(r[i]).addClass("selected").focus()}else{n.removeClass("selected");e.close()}break;case 39:case 9:if(n.nextAll().length===0){n.removeClass("selected").siblings(":first").focus().addClass("selected")}else{n.removeClass("selected").next().focus().addClass("selected")}break;case 40:var s=r.index(n)+e.config.columns;if(s<r.length){n.removeClass("selected");$(r[s]).addClass("selected").focus()}else if(e.config.includeDefault&&s<r.length+(e.config.columns-1)){n.removeClass("selected");r.last().addClass("selected").focus()}break}return false},mouseup:function(t){var n=$(this);n.siblings().andSelf().removeClass("selected");var r=n.attr("data-color"),i=n.attr("title");e.$input.val(r).removeClass("open").focus().css({backgroundColor:"#"+r,color:"#"+r}).attr("title",e.config.textCurrentColor+i);e.close();t.stopPropagation();return false}})}};$.fn.simpleColorPicker=function(e){return this.each(function(){(new SimpleColorPicker(this,e)).init()})}})(jQuery,window,document)